<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê³µí‰í•œ ì„¸ê¸ˆ ë¶„ë°° - ì„¸ì‹¬ì´ì™€ í•¨ê»˜í•˜ëŠ” ì¡°ì„¸ í˜•í‰ì„±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            min-height: 100dvh;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            position: relative;
            overflow: hidden;
        }
        
        /* ì‹œì‘ í™”ë©´ */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FF9800 0%, #F57C00 50%, #E65100 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.5s, visibility 0.5s;
            padding: 10px;
            overflow-y: auto;
        }
        
        #start-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .game-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.8rem, 5vw, 3rem);
            color: #FFF;
            text-shadow: 2px 2px 0 #E65100, 4px 4px 0 rgba(0,0,0,0.3);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .game-subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.3rem);
            color: #FFF3E0;
            font-weight: 500;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* ì„¸ì‹¬ì´ ìºë¦­í„° */
        .sesim-character {
            width: 100px;
            height: 120px;
            position: relative;
            margin: 15px auto;
            animation: float 2s ease-in-out infinite;
        }
        
        .sesim-character.small {
            width: 70px;
            height: 85px;
            margin: 10px auto;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .sesim-body {
            width: 85px;
            height: 85px;
            background: linear-gradient(180deg, #4A3728 0%, #4A3728 45%, #FFD93D 45%, #FFD93D 100%);
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 3px solid #3D2E1F;
        }
        
        .sesim-character.small .sesim-body {
            width: 60px;
            height: 60px;
        }
        
        .sesim-face {
            width: 60px;
            height: 42px;
            background: #FFE4B5;
            border-radius: 50%;
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .sesim-character.small .sesim-face {
            width: 42px;
            height: 30px;
            top: 8px;
        }
        
        .sesim-eye {
            width: 7px;
            height: 9px;
            background: #2D2D2D;
            border-radius: 50%;
            position: absolute;
            top: 15px;
        }
        
        .sesim-eye.left { left: 15px; }
        .sesim-eye.right { right: 15px; }
        
        .sesim-character.small .sesim-eye {
            width: 5px;
            height: 6px;
            top: 10px;
        }
        
        .sesim-character.small .sesim-eye.left { left: 10px; }
        .sesim-character.small .sesim-eye.right { right: 10px; }
        
        .sesim-mouth {
            width: 12px;
            height: 8px;
            background: #E85A4F;
            border-radius: 0 0 10px 10px;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .sesim-character.small .sesim-mouth {
            width: 8px;
            height: 5px;
            bottom: 7px;
        }
        
        .sesim-cheek {
            width: 10px;
            height: 6px;
            background: #FFB6C1;
            border-radius: 50%;
            position: absolute;
            top: 24px;
            opacity: 0.7;
        }
        
        .sesim-cheek.left { left: 6px; }
        .sesim-cheek.right { right: 6px; }
        
        .sesim-character.small .sesim-cheek {
            width: 7px;
            height: 4px;
            top: 17px;
        }
        
        .sesim-character.small .sesim-cheek.left { left: 4px; }
        .sesim-character.small .sesim-cheek.right { right: 4px; }
        
        .sesim-antenna {
            width: 3px;
            height: 25px;
            background: #4A3728;
            position: absolute;
            top: -20px;
            border-radius: 2px;
        }
        
        .sesim-antenna.left { left: 30px; transform: rotate(-15deg); }
        .sesim-antenna.right { right: 30px; transform: rotate(15deg); }
        
        .sesim-character.small .sesim-antenna {
            width: 2px;
            height: 18px;
            top: -15px;
        }
        
        .sesim-character.small .sesim-antenna.left { left: 20px; }
        .sesim-character.small .sesim-antenna.right { right: 20px; }
        
        .sesim-antenna-ball {
            width: 12px;
            height: 12px;
            background: #FFD93D;
            border-radius: 50%;
            position: absolute;
            top: -7px;
            left: -4.5px;
            border: 2px solid #4A3728;
        }
        
        .sesim-character.small .sesim-antenna-ball {
            width: 8px;
            height: 8px;
            top: -5px;
            left: -3px;
        }
        
        .sesim-wing {
            width: 30px;
            height: 38px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            position: absolute;
            top: 25px;
            border: 2px solid rgba(150, 150, 150, 0.3);
            animation: wingFlap 0.15s ease-in-out infinite alternate;
        }
        
        .sesim-wing.left { left: -17px; transform: rotate(-20deg); }
        .sesim-wing.right { right: -17px; transform: rotate(20deg); animation-delay: 0.075s; }
        
        .sesim-character.small .sesim-wing {
            width: 20px;
            height: 26px;
            top: 18px;
        }
        
        .sesim-character.small .sesim-wing.left { left: -12px; }
        .sesim-character.small .sesim-wing.right { right: -12px; }
        
        @keyframes wingFlap {
            0% { transform: rotate(-20deg) scaleY(1); }
            100% { transform: rotate(-30deg) scaleY(0.9); }
        }
        
        .sesim-badge {
            width: 22px;
            height: 15px;
            background: #FFF;
            border: 1px solid #CCC;
            position: absolute;
            bottom: 17px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
            font-size: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .sesim-character.small .sesim-badge {
            width: 16px;
            height: 11px;
            bottom: 12px;
            font-size: 4px;
        }
        
        .start-btn {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            padding: 12px 50px;
            background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #2E7D32, 0 7px 15px rgba(0,0,0,0.3);
            transition: all 0.1s;
            margin-top: 15px;
        }
        
        .start-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #2E7D32, 0 3px 8px rgba(0,0,0,0.3);
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #FFF3E0;
            font-size: clamp(0.8rem, 2.2vw, 1rem);
            line-height: 1.7;
            background: rgba(0,0,0,0.3);
            padding: 12px 20px;
            border-radius: 12px;
            max-width: 90%;
        }
        
        .instructions strong {
            color: #FFEB3B;
        }
        
        /* ê²Œì„ í™”ë©´ */
        #game-screen {
            width: 100%;
            height: 100%;
            display: none;
            position: relative;
            background: linear-gradient(180deg, #FFF8E1 0%, #FFECB3 50%, #FFE082 100%);
        }
        
        #game-screen.active {
            display: block;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* HUD */
        #hud {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .hud-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 700;
            color: #333;
            font-size: clamp(0.7rem, 2vw, 0.9rem);
        }
        
        .hud-icon {
            font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        }
        
        /* ì¼ì‹œì •ì§€ ë²„íŠ¼ */
        #pause-btn {
            background: linear-gradient(180deg, #FF9800 0%, #F57C00 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(0.7rem, 2vw, 0.85rem);
            cursor: pointer;
            box-shadow: 0 2px 0 #E65100;
            transition: all 0.1s;
        }
        
        #pause-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #E65100;
        }
        
        /* ì¼ì‹œì •ì§€ ì˜¤ë²„ë ˆì´ */
        #pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 40;
        }
        
        #pause-overlay.active {
            display: flex;
        }
        
        .pause-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            color: #FFF;
            margin-bottom: 30px;
        }
        
        .pause-btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .pause-menu-btn {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .pause-menu-btn.resume {
            background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            box-shadow: 0 4px 0 #2E7D32;
        }
        
        .pause-menu-btn.quit {
            background: linear-gradient(180deg, #F44336 0%, #D32F2F 100%);
            color: white;
            box-shadow: 0 4px 0 #B71C1C;
        }
        
        .pause-menu-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        }
        
        /* OX í€´ì¦ˆ ëª¨ë‹¬ */
        #quiz-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        
        #quiz-modal.active {
            display: flex;
        }
        
        .quiz-box {
            background: linear-gradient(180deg, #FFF9E6 0%, #FFF 100%);
            border-radius: 20px;
            padding: 20px;
            max-width: 92%;
            width: 500px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            border: 4px solid #FF9800;
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .quiz-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .quiz-icon {
            font-size: clamp(2rem, 6vw, 2.8rem);
        }
        
        .quiz-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.1rem, 3.5vw, 1.5rem);
            color: #E65100;
        }
        
        .quiz-question {
            font-size: clamp(0.95rem, 2.8vw, 1.2rem);
            color: #333;
            line-height: 1.6;
            margin-bottom: 18px;
            padding: 12px;
            background: #FFF;
            border-radius: 12px;
            border: 2px solid #EEE;
        }
        
        .quiz-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .quiz-btn {
            width: clamp(65px, 16vw, 90px);
            height: clamp(65px, 16vw, 90px);
            border-radius: 50%;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.6rem, 5vw, 2.2rem);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        
        .quiz-btn.o-btn {
            background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
            color: white;
        }
        
        .quiz-btn.x-btn {
            background: linear-gradient(180deg, #F44336 0%, #D32F2F 100%);
            color: white;
        }
        
        .quiz-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
        }
        
        .quiz-result {
            display: none;
            padding: 12px;
            border-radius: 10px;
            margin-top: 12px;
            font-size: clamp(0.85rem, 2.3vw, 1rem);
            font-weight: 700;
        }
        
        .quiz-result.correct {
            display: block;
            background: #E8F5E9;
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }
        
        .quiz-result.wrong {
            display: block;
            background: #FFEBEE;
            color: #C62828;
            border: 2px solid #F44336;
        }
        
        .result-btn {
            margin-top: 10px;
            padding: 10px 22px;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            font-size: clamp(0.85rem, 2.3vw, 1rem);
            color: white;
            border: none;
            border-radius: 18px;
            cursor: pointer;
        }
        
        .result-btn.retry {
            background: #FF9800;
            box-shadow: 0 3px 0 #F57C00;
        }
        
        .result-btn.continue {
            background: #4CAF50;
            box-shadow: 0 3px 0 #388E3C;
        }
        
        .result-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        }
        
        /* ê²°ê³¼ í™”ë©´ */
        #result-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            overflow-y: auto;
        }
        
        #result-screen.active {
            display: flex;
        }
        
        #result-screen.win {
            background: linear-gradient(180deg, #FFE66D 0%, #FFB347 100%);
        }
        
        #result-screen.lose {
            background: linear-gradient(180deg, #546E7A 0%, #37474F 100%);
        }
        
        .result-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
            font-size: clamp(1.8rem, 5.5vw, 2.8rem);
            margin-bottom: 10px;
            animation: bounce 0.6s ease-in-out infinite;
        }
        
        #result-screen.win .result-title {
            color: #E65100;
            text-shadow: 2px 2px 0 #FFE66D;
        }
        
        #result-screen.lose .result-title {
            color: #FFF;
            text-shadow: 2px 2px 0 #263238;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .result-stats {
            background: rgba(255,255,255,0.92);
            padding: 18px 30px;
            border-radius: 16px;
            margin: 12px 0;
            text-align: center;
        }
        
        .stat-row {
            font-size: clamp(0.95rem, 2.7vw, 1.2rem);
            color: #E65100;
            margin: 6px 0;
            font-weight: 700;
        }
        
        .achievement-badge {
            background: linear-gradient(180deg, #FF9800 0%, #F57C00 100%);
            color: #FFF;
            padding: 10px 22px;
            border-radius: 22px;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            font-size: clamp(1rem, 2.8vw, 1.3rem);
            margin-top: 12px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.2);
        }
        
        .result-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
        
        .end-btn {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            padding: 12px 40px;
            background: linear-gradient(180deg, #F44336 0%, #D32F2F 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #B71C1C, 0 6px 12px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }
        
        .end-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #B71C1C, 0 2px 6px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="start-screen">
            <h1 class="game-title">âš–ï¸ ê³µí‰í•œ ì„¸ê¸ˆ ë¶„ë°°</h1>
            <p class="game-subtitle">ì„¸ì‹¬ì´ì™€ í•¨ê»˜í•˜ëŠ” ì¡°ì„¸ í˜•í‰ì„±</p>
            
            <div class="sesim-character">
                <div class="sesim-body">
                    <div class="sesim-antenna left"><div class="sesim-antenna-ball"></div></div>
                    <div class="sesim-antenna right"><div class="sesim-antenna-ball"></div></div>
                    <div class="sesim-wing left"></div>
                    <div class="sesim-wing right"></div>
                    <div class="sesim-face">
                        <div class="sesim-eye left"></div>
                        <div class="sesim-eye right"></div>
                        <div class="sesim-cheek left"></div>
                        <div class="sesim-cheek right"></div>
                        <div class="sesim-mouth"></div>
                    </div>
                    <div class="sesim-badge">ì„¸ì‹¬</div>
                </div>
            </div>
            
            <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘!</button>
            
            <div class="instructions">
                ğŸ® <strong>ê²Œì„ ë°©ë²•</strong><br>
                ì‹œë¯¼ë“¤ì—ê²Œ ì†Œë“ì— ë§ëŠ” ì„¸ê¸ˆì„ ë¶„ë°°í•˜ì„¸ìš”!<br><br>
                ğŸ“Š <strong>ìˆ˜ì§ì  í˜•í‰ì„±</strong>: ì†Œë“ì´ ë§ìœ¼ë©´ ì„¸ê¸ˆë„ ë§ì´!<br>
                ğŸ“Š <strong>ìˆ˜í‰ì  í˜•í‰ì„±</strong>: ì†Œë“ì´ ê°™ìœ¼ë©´ ì„¸ê¸ˆë„ ê°™ê²Œ!<br><br>
                â­ ì„¸ê¸ˆ ì½”ì¸ì„ ë“œë˜ê·¸í•˜ì—¬ ì‹œë¯¼ì—ê²Œ ë°°ë¶„í•˜ì„¸ìš”!<br>
                ğŸ¯ 6ê°œì˜ ë¼ìš´ë“œì™€ 6ê°œì˜ í€´ì¦ˆë¥¼ í†µê³¼í•˜ë©´ ìŠ¹ë¦¬!
            </div>
        </div>
        
        <!-- ê²Œì„ í™”ë©´ -->
        <div id="game-screen">
            <canvas id="game-canvas"></canvas>
            
            <div id="hud">
                <div class="hud-item">
                    <span class="hud-icon">ğŸ¯</span>
                    <span id="round-display">ë¼ìš´ë“œ 1/6</span>
                </div>
                <div class="hud-item">
                    <span class="hud-icon">ğŸ’°</span>
                    <span id="score-display">0</span>
                </div>
                <div class="hud-item">
                    <span class="hud-icon">âœ…</span>
                    <span id="quiz-display">0/6</span>
                </div>
                <div class="hud-item">
                    <span class="hud-icon">âš–ï¸</span>
                    <span id="fairness-display">ê³µì •ë„: 100%</span>
                </div>
                <button id="pause-btn" onclick="togglePause()">ì¼ì‹œì •ì§€</button>
            </div>
            
            <!-- ì¼ì‹œì •ì§€ ì˜¤ë²„ë ˆì´ -->
            <div id="pause-overlay">
                <h2 class="pause-title">â¸ï¸ ì¼ì‹œ ì •ì§€</h2>
                <div class="pause-btn-group">
                    <button class="pause-menu-btn resume" onclick="togglePause()">â–¶ï¸ ê³„ì† í•˜ê¸°</button>
                    <button class="pause-menu-btn quit" onclick="quitToStart()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
                </div>
            </div>
        </div>
        
        <!-- OX í€´ì¦ˆ ëª¨ë‹¬ -->
        <div id="quiz-modal">
            <div class="quiz-box">
                <div class="quiz-header">
                    <span class="quiz-icon" id="quiz-icon">âš–ï¸</span>
                    <h2 class="quiz-title" id="quiz-title">ì¡°ì„¸ í˜•í‰ì„± í€´ì¦ˆ!</h2>
                </div>
                <p class="quiz-question" id="quiz-question">
                    ìˆ˜ì§ì  í˜•í‰ì„±ì´ë€ ì†Œë“ì´ ë§ì€ ì‚¬ëŒì´ ë” ë§ì€ ì„¸ê¸ˆì„ ë‚´ëŠ” ê²ƒì´ë‹¤.
                </p>
                <div class="quiz-buttons" id="quiz-buttons">
                    <button class="quiz-btn o-btn" onclick="answerQuiz(true)">O</button>
                    <button class="quiz-btn x-btn" onclick="answerQuiz(false)">X</button>
                </div>
                <div class="quiz-result" id="quiz-result"></div>
            </div>
        </div>
        
        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="result-screen">
            <h1 class="result-title" id="result-title">ğŸ‰ ê²Œì„ í´ë¦¬ì–´!</h1>
            
            <div class="sesim-character small">
                <div class="sesim-body">
                    <div class="sesim-antenna left"><div class="sesim-antenna-ball"></div></div>
                    <div class="sesim-antenna right"><div class="sesim-antenna-ball"></div></div>
                    <div class="sesim-wing left"></div>
                    <div class="sesim-wing right"></div>
                    <div class="sesim-face">
                        <div class="sesim-eye left"></div>
                        <div class="sesim-eye right"></div>
                        <div class="sesim-cheek left"></div>
                        <div class="sesim-cheek right"></div>
                        <div class="sesim-mouth"></div>
                    </div>
                    <div class="sesim-badge">ì„¸ì‹¬</div>
                </div>
            </div>
            
            <div class="result-stats">
                <div class="stat-row">âœ… í†µê³¼í•œ í€´ì¦ˆ: <span id="final-quiz">6</span>/6</div>
                <div class="stat-row">ğŸ’° íšë“ ì ìˆ˜: <span id="final-score">0</span>ì </div>
                <div class="stat-row">âš–ï¸ í‰ê·  ê³µì •ë„: <span id="final-fairness">100</span>%</div>
            </div>
            
            <div class="achievement-badge" id="achievement-badge">ğŸ† ê³µì •í•œ ì„¸ë¬´ì‚¬!</div>
            
            <div class="result-buttons">
                <button class="start-btn" onclick="restartGame()">ë‹¤ì‹œ í•˜ê¸°</button>
                <button class="end-btn" onclick="endGame()">ê²Œì„ ì¢…ë£Œ</button>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ì„¤ì •
        const CONFIG = {
            TOTAL_ROUNDS: 6,
            TOTAL_QUIZZES: 6
        };

        // ê²Œì„ ìƒíƒœ
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            round: 1,
            quizzesPassed: 0,
            fairness: 100,
            totalFairness: 0,
            currentQuiz: null,
            usedQuizIndices: [],
            screenFlash: null,
            feedbackMessage: null // í”¼ë“œë°± ë©”ì‹œì§€
        };

        // ìº”ë²„ìŠ¤
        let canvas, ctx;
        let canvasWidth, canvasHeight;

        // ê²Œì„ ì˜¤ë¸Œì íŠ¸
        let citizens = [];
        let taxCoins = [];
        let draggedCoin = null;
        let sesim = null;
        let particles = [];
        let checkButton = null;

        // ì‹œë¯¼ ë°ì´í„° (ë¼ìš´ë“œë³„)
        const roundData = [
            // ë¼ìš´ë“œ 1: ìˆ˜ì§ì  í˜•í‰ì„± ê¸°ë³¸
            {
                title: 'ìˆ˜ì§ì  í˜•í‰ì„±',
                description: 'ì†Œë“ì´ ë§ìœ¼ë©´ ì„¸ê¸ˆë„ ë§ì´!',
                citizens: [
                    { name: 'ê¹€ë¶€ì', income: 5000, correctTax: 3, emoji: 'ğŸ§‘â€ğŸ’¼' },
                    { name: 'ì´ì¤‘ì‚°', income: 3000, correctTax: 2, emoji: 'ğŸ‘¨â€ğŸ”§' },
                    { name: 'ë°•ì„œë¯¼', income: 1000, correctTax: 1, emoji: 'ğŸ‘©â€ğŸŒ¾' }
                ],
                totalCoins: 6
            },
            // ë¼ìš´ë“œ 2: ìˆ˜í‰ì  í˜•í‰ì„±
            {
                title: 'ìˆ˜í‰ì  í˜•í‰ì„±',
                description: 'ì†Œë“ì´ ê°™ìœ¼ë©´ ì„¸ê¸ˆë„ ê°™ê²Œ!',
                citizens: [
                    { name: 'ìµœíšŒì‚¬', income: 3000, correctTax: 2, emoji: 'ğŸ‘¨â€ğŸ’»' },
                    { name: 'ì •íšŒì‚¬', income: 3000, correctTax: 2, emoji: 'ğŸ‘©â€ğŸ’»' },
                    { name: 'ê°•ìì˜', income: 3000, correctTax: 2, emoji: 'ğŸ§‘â€ğŸ³' }
                ],
                totalCoins: 6
            },
            // ë¼ìš´ë“œ 3: í˜¼í•©
            {
                title: 'ê³µí‰í•œ ë¶„ë°°',
                description: 'ì†Œë“ì— ë”°ë¼ ê³µí‰í•˜ê²Œ!',
                citizens: [
                    { name: 'ìœ¤ì‚¬ì¥', income: 8000, correctTax: 4, emoji: 'ğŸ§‘â€ğŸ’¼' },
                    { name: 'ì„ê³¼ì¥', income: 4000, correctTax: 2, emoji: 'ğŸ‘¨â€ğŸ’¼' },
                    { name: 'í•œëŒ€ë¦¬', income: 2000, correctTax: 1, emoji: 'ğŸ‘©â€ğŸ’¼' },
                    { name: 'ì˜¤ì‚¬ì›', income: 2000, correctTax: 1, emoji: 'ğŸ§‘â€ğŸ“' }
                ],
                totalCoins: 8
            },
            // ë¼ìš´ë“œ 4: ë‹¤ì–‘í•œ ì†Œë“
            {
                title: 'ë‹¤ì–‘í•œ ì†Œë“ì¸µ',
                description: 'ê²½ì œì  ëŠ¥ë ¥ì— ë§ê²Œ!',
                citizens: [
                    { name: 'ì¬ë²Œë‹˜', income: 10000, correctTax: 4, emoji: 'ğŸ¤µ' },
                    { name: 'ì˜ì‚¬ë‹˜', income: 5000, correctTax: 2, emoji: 'ğŸ‘¨â€âš•ï¸' },
                    { name: 'ì„ ìƒë‹˜', income: 2500, correctTax: 1, emoji: 'ğŸ‘©â€ğŸ«' },
                    { name: 'í•™ìƒ', income: 500, correctTax: 0, emoji: 'ğŸ§‘â€ğŸ“' }
                ],
                totalCoins: 7
            },
            // ë¼ìš´ë“œ 5: ë³µì¡í•œ ë¶„ë°°
            {
                title: 'ì¡°ì„¸ì˜ íš¨ìœ¨ì„±',
                description: 'ì ì ˆí•˜ê²Œ ë¶„ë°°í•´ìš”!',
                citizens: [
                    { name: 'ëŒ€ê¸°ì—…', income: 6000, correctTax: 3, emoji: 'ğŸ¢' },
                    { name: 'ì¤‘ê¸°ì—…', income: 4000, correctTax: 2, emoji: 'ğŸ­' },
                    { name: 'ì†Œê¸°ì—…', income: 2000, correctTax: 1, emoji: 'ğŸª' },
                    { name: 'ìì˜ì—…', income: 2000, correctTax: 1, emoji: 'ğŸ›’' }
                ],
                totalCoins: 7
            },
            // ë¼ìš´ë“œ 6: ìµœì¢…
            {
                title: 'ëª¨ë‘ê°€ ë‚©ë“í•˜ëŠ” ì„¸ê¸ˆ',
                description: 'í˜•í‰ì„±ì˜ ì™„ì„±!',
                citizens: [
                    { name: 'ê³ ì†Œë“', income: 9000, correctTax: 4, emoji: 'ğŸ’' },
                    { name: 'ì¤‘ì†Œë“A', income: 4500, correctTax: 2, emoji: 'ğŸ’¼' },
                    { name: 'ì¤‘ì†Œë“B', income: 4500, correctTax: 2, emoji: 'ğŸ’¼' },
                    { name: 'ì €ì†Œë“', income: 1500, correctTax: 1, emoji: 'ğŸŒ±' }
                ],
                totalCoins: 9
            }
        ];

        // í€´ì¦ˆ ë°ì´í„°
        const quizzes = [
            {
                icon: 'ğŸ“Š',
                title: 'ìˆ˜ì§ì  í˜•í‰ì„±',
                question: 'ìˆ˜ì§ì  í˜•í‰ì„±ì´ë€ ê²½ì œì  ëŠ¥ë ¥ì´ í´ìˆ˜ë¡ ë” ë§ì€ ì„¸ê¸ˆì„ ë¶€ë‹´í•´ì•¼ í•œë‹¤ëŠ” ì›ì¹™ì´ë‹¤.',
                answer: true,
                explanation: 'ìˆ˜ì§ì  í˜•í‰ì„±ì€ ì‚¬ëŒë§ˆë‹¤ ì†Œë“ê³¼ ì¬ì‚° ìˆ˜ì¤€ì´ ë‹¤ë¥´ë‹¤ëŠ” ì ì„ ê³ ë ¤í•˜ì—¬, ì†Œë“ê³¼ ì¬ì‚°ì´ ë§ì€ ì‚¬ëŒì´ ê·¸ë ‡ì§€ ì•Šì€ ì‚¬ëŒë³´ë‹¤ ë” ë§ì€ ì„¸ê¸ˆì„ ë¶€ë‹´í•˜ë„ë¡ í•˜ëŠ” ì›ì¹™ì…ë‹ˆë‹¤. '
            },
            {
                icon: 'ğŸ“Š',
                title: 'ìˆ˜í‰ì  í˜•í‰ì„±',
                question: 'ìˆ˜í‰ì  í˜•í‰ì„±ì´ë€ ê²½ì œì  ëŠ¥ë ¥ì´ ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ì€ ë¹„ìŠ·í•˜ê²Œ ì„¸ê¸ˆì„ ë‚´ì•¼ í•œë‹¤ëŠ” ì›ì¹™ì´ë‹¤.',
                answer: true,
                explanation: 'ìˆ˜í‰ì  í˜•í‰ì„±ì€ íŠ¹ë³„í•œ ì´ìœ  ì—†ì´ ëˆ„êµ¬ì—ê²Œë§Œ ë¶ˆë¦¬í•˜ê±°ë‚˜ ìœ ë¦¬í•´ì„œëŠ” ì•ˆ ëœë‹¤ëŠ” ì ì„ ê³ ë ¤í•˜ì—¬, ë™ì¼í•œ ê²½ì œì  ëŠ¥ë ¥ì„ ê°€ì§„ ì‚¬ëŒì€ ë™ì¼í•œ ìˆ˜ì¤€ì˜ ì„¸ê¸ˆì„ ë¶€ë‹´í•´ì•¼ í•œë‹¤ëŠ” ì›ì¹™ì…ë‹ˆë‹¤.'
            },
            {
                icon: 'âš–ï¸',
                title: 'ê³µí‰í•œ ì„¸ê¸ˆ',
                question: 'ëª¨ë“  êµ­ë¯¼ì´ ë˜‘ê°™ì€ ê¸ˆì•¡ì˜ ì„¸ê¸ˆì„ ë‚´ëŠ” ê²ƒì´ ê°€ì¥ ê³µí‰í•˜ë‹¤.',
                answer: false,
                explanation: 'ê³µí‰ì´ë€ ë˜‘ê°™ì´ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ìì˜ ìƒí™©(ì†Œë“ê³¼ ì¬ì‚°)ì„ ê³ ë ¤í•´ ë‚˜ëˆ„ëŠ” ê²ƒì…ë‹ˆë‹¤.'
            },
            {
                icon: 'ğŸ’°',
                title: 'ì¡°ì„¸ì˜ íš¨ìœ¨ì„±',
                question: 'ì„¸ê¸ˆì„ ë§ì´ ê±·ì„ìˆ˜ë¡ í•­ìƒ ì¢‹ë‹¤.',
                answer: false,
                explanation: 'ê³¼ë„í•œ ì„¸ê¸ˆì€ ì†Œë¹„ì™€ íˆ¬ìë¥¼ ì¤„ì—¬ ê²½ì œë¥¼ ìœ„ì¶•ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
            },
            {
                icon: 'ğŸ›ï¸',
                title: 'ì„¸ê¸ˆì˜ ì—­í• ',
                question: 'ì¡°ì„¸ì˜ í˜•í‰ì„±ì€ ì‚¬íšŒì  ë¶ˆí‰ë“±ì„ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ëœë‹¤.',
                answer: true,
                explanation: 'ìˆ˜ì§ì  í˜•í‰ì„±ì„ í†µí•´ ì†Œë“ê³¼ ë¶€ì˜ ì¬ë¶„ë°°ê°€ ì´ë£¨ì–´ì ¸ ì‚¬íšŒì  ë¶ˆí‰ë“±ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
            },
            {
                icon: 'ğŸ“‹',
                title: 'ë‚©ì„¸ì˜ ê¸°ì¤€',
                question: 'ì¡°ì„¸ì˜ í˜•í‰ì„±ì€ ëª¨ë‘ê°€ ë‚©ë“í•  ìˆ˜ ìˆëŠ” ì„¸ê¸ˆ ì œë„ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ì¤‘ìš”í•œ ê¸°ì¤€ì´ë‹¤.',
                answer: true,
                explanation: 'ê³µí‰í•œ ì„¸ê¸ˆ ì œë„ê°€ ìˆì–´ì•¼ êµ­ë¯¼ë“¤ì´ ê¸°êº¼ì´ ì„¸ê¸ˆì„ ë‚©ë¶€í•©ë‹ˆë‹¤.'
            }
        ];

        // ì´ˆê¸°í™”
        function init() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // í„°ì¹˜/ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            canvas.addEventListener('mousedown', handlePointerDown);
            canvas.addEventListener('mousemove', handlePointerMove);
            canvas.addEventListener('mouseup', handlePointerUp);
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvasWidth = canvas.width;
            canvasHeight = canvas.height;
            
            // ê²Œì„ ì¤‘ì´ë©´ í˜„ì¬ ë¼ìš´ë“œ ìš”ì†Œ ì¬ë°°ì¹˜
            if (gameState.isPlaying && citizens.length > 0) {
                const data = roundData[gameState.round - 1];
                const isMobile = canvasHeight < 700;
                const citizenWidth = Math.min(140, (canvasWidth - 40) / citizens.length - 10);
                const startX = (canvasWidth - (citizenWidth + 10) * citizens.length) / 2;
                const citizenY = isMobile ? canvasHeight - 190 : canvasHeight - 220;
                
                citizens.forEach((c, i) => {
                    c.x = startX + i * (citizenWidth + 10);
                    c.y = citizenY;
                    c.width = citizenWidth;
                });
                
                // ì½”ì¸ ìœ„ì¹˜ ì¬ë°°ì¹˜ (ë“œë˜ê·¸ ì¤‘ì´ ì•„ë‹Œ ê²ƒë§Œ)
                const coinY = isMobile ? 195 : 210;
                const freeCoins = taxCoins.filter(c => !c.isDragging && !c.assignedTo);
                const coinStartX = canvasWidth / 2 - (freeCoins.length * 30) / 2;
                freeCoins.forEach((c, i) => {
                    c.x = coinStartX + i * 35 + 20;
                    c.y = coinY;
                });
                
                // ë²„íŠ¼ ì¬ë°°ì¹˜
                const buttonY = isMobile ? canvasHeight - 35 : canvasHeight - 55;
                if (checkButton) {
                    checkButton.x = canvasWidth / 2 - 130;
                    checkButton.y = buttonY;
                }
                if (resetButton) {
                    resetButton.x = canvasWidth / 2 + 10;
                    resetButton.y = buttonY;
                }
                
                // ì„¸ì‹¬ì´ ìœ„ì¹˜
                if (sesim) {
                    sesim.x = 70;
                }
            }
        }

        function handlePointerDown(e) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            checkInteraction(x, y);
        }

        function handlePointerMove(e) {
            if (!gameState.isPlaying || gameState.isPaused || !draggedCoin) return;
            const rect = canvas.getBoundingClientRect();
            draggedCoin.x = e.clientX - rect.left;
            draggedCoin.y = e.clientY - rect.top;
        }

        function handlePointerUp(e) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            handleDrop(x, y);
        }

        function handleTouchStart(e) {
            e.preventDefault();
            if (!gameState.isPlaying || gameState.isPaused) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            checkInteraction(x, y);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!gameState.isPlaying || gameState.isPaused || !draggedCoin) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            draggedCoin.x = touch.clientX - rect.left;
            draggedCoin.y = touch.clientY - rect.top;
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (!gameState.isPlaying || gameState.isPaused) return;
            if (draggedCoin) {
                handleDrop(draggedCoin.x, draggedCoin.y);
            }
        }

        function checkInteraction(x, y) {
            // í™•ì¸ ë²„íŠ¼ ì²´í¬
            if (checkButton && x >= checkButton.x && x <= checkButton.x + checkButton.width &&
                y >= checkButton.y && y <= checkButton.y + checkButton.height) {
                checkDistribution();
                return;
            }
            
            // ë¦¬ì…‹ ë²„íŠ¼ ì²´í¬
            if (resetButton && x >= resetButton.x && x <= resetButton.x + resetButton.width &&
                y >= resetButton.y && y <= resetButton.y + resetButton.height) {
                resetRound();
                return;
            }
            
            // ì‹œë¯¼ì—ê²Œ ë°°ë¶„ëœ ì½”ì¸ íšŒìˆ˜
            for (const citizen of citizens) {
                if (citizen.assignedCoins > 0) {
                    if (x >= citizen.x && x <= citizen.x + citizen.width &&
                        y >= citizen.y + 100 && y <= citizen.y + 150) {
                        citizen.assignedCoins--;
                        taxCoins.push({
                            x: x,
                            y: y,
                            size: 25,
                            isDragging: true
                        });
                        draggedCoin = taxCoins[taxCoins.length - 1];
                        gameState.feedbackMessage = null;
                        return;
                    }
                }
            }
            
            // ì„¸ê¸ˆ ì½”ì¸ ë“œë˜ê·¸
            for (let i = taxCoins.length - 1; i >= 0; i--) {
                const coin = taxCoins[i];
                const dist = Math.sqrt((x - coin.x) ** 2 + (y - coin.y) ** 2);
                if (dist < coin.size) {
                    draggedCoin = coin;
                    draggedCoin.isDragging = true;
                    gameState.feedbackMessage = null;
                    return;
                }
            }
        }

        function handleDrop(x, y) {
            if (!draggedCoin) return;
            
            // ì‹œë¯¼ì—ê²Œ ë“œë¡­
            for (const citizen of citizens) {
                if (x >= citizen.x - 10 && x <= citizen.x + citizen.width + 10 &&
                    y >= citizen.y - 10 && y <= citizen.y + citizen.height + 10) {
                    citizen.assignedCoins++;
                    const idx = taxCoins.indexOf(draggedCoin);
                    if (idx > -1) taxCoins.splice(idx, 1);
                    createParticles(citizen.x + citizen.width/2, citizen.y + citizen.height/2, '#FFD700', 8);
                    draggedCoin = null;
                    return;
                }
            }
            
            draggedCoin.isDragging = false;
            draggedCoin = null;
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('active');
            
            resetGameState();
            setupRound();
            createSesim();
            
            gameState.isPlaying = true;
            updateHUD();
            gameLoop();
        }

        function resetGameState() {
            gameState.score = 0;
            gameState.round = 1;
            gameState.quizzesPassed = 0;
            gameState.fairness = 100;
            gameState.totalFairness = 0;
            gameState.isPaused = false;
            gameState.currentQuiz = null;
            gameState.usedQuizIndices = [];
            gameState.screenFlash = null;
            gameState.feedbackMessage = null;
            citizens = [];
            taxCoins = [];
            particles = [];
            draggedCoin = null;
        }

        // ë¦¬ì…‹ ë²„íŠ¼
        let resetButton = null;
        
        function setupRound() {
            const data = roundData[gameState.round - 1];
            citizens = [];
            taxCoins = [];
            
            // ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ê³„ì‚°
            const isMobile = canvasHeight < 700;
            const citizenWidth = Math.min(140, (canvasWidth - 40) / data.citizens.length - 10);
            const startX = (canvasWidth - (citizenWidth + 10) * data.citizens.length) / 2;
            const citizenY = isMobile ? canvasHeight - 190 : canvasHeight - 220;
            
            data.citizens.forEach((c, i) => {
                citizens.push({
                    ...c,
                    x: startX + i * (citizenWidth + 10),
                    y: citizenY,
                    width: citizenWidth,
                    height: 150,
                    assignedCoins: 0
                });
            });
            
            // ì„¸ê¸ˆ ì½”ì¸ ìƒì„± - ìœ„ì¹˜ ì¡°ì •
            const coinY = isMobile ? 195 : 210;
            const coinStartX = canvasWidth / 2 - (data.totalCoins * 30) / 2;
            for (let i = 0; i < data.totalCoins; i++) {
                taxCoins.push({
                    x: coinStartX + i * 35 + 20,
                    y: coinY,
                    size: 25,
                    isDragging: false
                });
            }
            
            // í™•ì¸ ë²„íŠ¼ - ë°˜ì‘í˜• ìœ„ì¹˜
            const buttonY = isMobile ? canvasHeight - 35 : canvasHeight - 55;
            checkButton = {
                x: canvasWidth / 2 - 130,
                y: buttonY,
                width: 120,
                height: 40
            };
            
            // ë¦¬ì…‹ ë²„íŠ¼
            resetButton = {
                x: canvasWidth / 2 + 10,
                y: buttonY,
                width: 120,
                height: 40
            };
        }

        function createSesim() {
            sesim = {
                x: 70,
                y: 130,
                size: 45,
                wingAngle: 0,
                floatOffset: 0
            };
        }

        function checkDistribution() {
            let correct = true;
            let totalDiff = 0;
            let hints = [];
            
            for (const citizen of citizens) {
                const diff = citizen.assignedCoins - citizen.correctTax;
                totalDiff += Math.abs(diff);
                if (diff !== 0) {
                    correct = false;
                    if (diff > 0) {
                        hints.push(`${citizen.name}ì—ê²Œ ë„ˆë¬´ ë§ì´!`);
                    } else {
                        hints.push(`${citizen.name}ì—ê²Œ ë” í•„ìš”í•´ìš”!`);
                    }
                }
            }
            
            // ë‚¨ì€ ì½”ì¸ ì²´í¬
            if (taxCoins.length > 0) {
                correct = false;
                hints.push(`ì½”ì¸ ${taxCoins.length}ê°œê°€ ë‚¨ì•˜ì–´ìš”!`);
            }
            
            if (correct) {
                // ì •ë‹µ!
                gameState.score += 50;
                gameState.fairness = 100;
                gameState.totalFairness += 100;
                gameState.screenFlash = { color: 'rgba(76, 175, 80, 0.3)', time: 15 };
                gameState.feedbackMessage = null;
                createParticles(canvasWidth / 2, canvasHeight / 2, '#4CAF50', 20);
                
                // í€´ì¦ˆ í‘œì‹œ
                setTimeout(() => showQuiz(), 500);
            } else {
                // ì˜¤ë‹µ - íŒíŠ¸ í‘œì‹œ
                gameState.fairness = Math.max(0, 100 - totalDiff * 20);
                gameState.screenFlash = { color: 'rgba(244, 67, 54, 0.4)', time: 20 };
                gameState.feedbackMessage = {
                    text: hints.slice(0, 2).join(' '),
                    time: 180 // 3ì´ˆê°„ í‘œì‹œ
                };
            }
            
            updateHUD();
        }
        
        function resetRound() {
            // í˜„ì¬ ë¼ìš´ë“œ ë‹¤ì‹œ ì„¤ì •
            setupRound();
            gameState.feedbackMessage = null;
            updateHUD();
        }

        function showQuiz() {
            gameState.isPaused = true;
            
            let quizIndex;
            if (gameState.round <= quizzes.length) {
                quizIndex = gameState.round - 1;
            } else {
                quizIndex = Math.floor(Math.random() * quizzes.length);
            }
            
            const quiz = quizzes[quizIndex];
            gameState.currentQuiz = { ...quiz, index: quizIndex };
            
            document.getElementById('quiz-icon').textContent = quiz.icon;
            document.getElementById('quiz-title').textContent = quiz.title;
            document.getElementById('quiz-question').textContent = quiz.question;
            document.getElementById('quiz-result').className = 'quiz-result';
            document.getElementById('quiz-result').innerHTML = '';
            document.getElementById('quiz-buttons').style.display = 'flex';
            
            document.getElementById('quiz-modal').classList.add('active');
        }

        function answerQuiz(answer) {
            const quiz = gameState.currentQuiz;
            const resultDiv = document.getElementById('quiz-result');
            const buttonsDiv = document.getElementById('quiz-buttons');
            
            if (answer === quiz.answer) {
                resultDiv.className = 'quiz-result correct';
                resultDiv.innerHTML = `
                    <p>ğŸ‰ ì •ë‹µì´ì—ìš”!</p>
                    <p style="margin-top: 6px; font-weight: normal; font-size: 0.9em;">${quiz.explanation}</p>
                    <button class="result-btn continue" onclick="closeQuiz(true)">ë‹¤ìŒ ë¼ìš´ë“œ</button>
                `;
                buttonsDiv.style.display = 'none';
            } else {
                resultDiv.className = 'quiz-result wrong';
                resultDiv.innerHTML = `
                    <p>âŒ í‹€ë ¸ì–´ìš”!</p>
                    <p style="margin-top: 6px; font-weight: normal; font-size: 0.9em;">ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!</p>
                    <button class="result-btn retry" onclick="retryQuiz()">ë‹¤ì‹œ í’€ê¸°</button>
                `;
                buttonsDiv.style.display = 'none';
            }
        }

        function retryQuiz() {
            document.getElementById('quiz-result').className = 'quiz-result';
            document.getElementById('quiz-result').innerHTML = '';
            document.getElementById('quiz-buttons').style.display = 'flex';
        }

        function closeQuiz(success) {
            document.getElementById('quiz-modal').classList.remove('active');
            
            if (success) {
                gameState.quizzesPassed++;
                gameState.score += 30;
                
                if (gameState.round >= CONFIG.TOTAL_ROUNDS) {
                    // ê²Œì„ í´ë¦¬ì–´
                    setTimeout(() => gameOver(true), 300);
                } else {
                    // ë‹¤ìŒ ë¼ìš´ë“œ
                    gameState.round++;
                    setupRound();
                    updateHUD();
                }
            }
            
            gameState.isPaused = false;
            gameState.currentQuiz = null;
        }

        function restartGame() {
            document.getElementById('result-screen').classList.remove('active', 'win', 'lose');
            document.getElementById('game-screen').classList.add('active');
            
            resetGameState();
            setupRound();
            createSesim();
            
            gameState.isPlaying = true;
            updateHUD();
            gameLoop(); // ê²Œì„ ë£¨í”„ ì¬ì‹œì‘
        }

        function gameOver(isWin) {
            gameState.isPlaying = false;
            
            document.getElementById('game-screen').classList.remove('active');
            const resultScreen = document.getElementById('result-screen');
            resultScreen.classList.add('active');
            resultScreen.classList.add(isWin ? 'win' : 'lose');
            
            document.getElementById('result-title').textContent = isWin ? 'ğŸ‰ ê²Œì„ í´ë¦¬ì–´!' : 'ğŸ˜¢ ê²Œì„ ì˜¤ë²„';
            document.getElementById('final-quiz').textContent = gameState.quizzesPassed;
            document.getElementById('final-score').textContent = gameState.score;
            document.getElementById('final-fairness').textContent = Math.round(gameState.totalFairness / gameState.round);
            
            document.getElementById('achievement-badge').textContent = isWin ? 'ğŸ† ê³µì •í•œ ì„¸ë¬´ì‚¬!' : 'ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!';
        }

        function updateHUD() {
            document.getElementById('round-display').textContent = `ë¼ìš´ë“œ ${gameState.round}/${CONFIG.TOTAL_ROUNDS}`;
            document.getElementById('score-display').textContent = gameState.score;
            document.getElementById('quiz-display').textContent = `${gameState.quizzesPassed}/${CONFIG.TOTAL_QUIZZES}`;
            document.getElementById('fairness-display').textContent = `ê³µì •ë„: ${gameState.fairness}%`;
        }

        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 3,
                    color: color,
                    size: Math.random() * 6 + 3,
                    life: 40
                });
            }
        }

        // ì¼ì‹œ ì •ì§€ í† ê¸€
        function togglePause() {
            if (!gameState.isPlaying) return;
            
            gameState.isPaused = !gameState.isPaused;
            const pauseOverlay = document.getElementById('pause-overlay');
            const pauseBtn = document.getElementById('pause-btn');
            
            if (gameState.isPaused) {
                pauseOverlay.classList.add('active');
                pauseBtn.textContent = 'ê³„ì†í•˜ê¸°';
            } else {
                pauseOverlay.classList.remove('active');
                pauseBtn.textContent = 'ì¼ì‹œì •ì§€';
            }
        }
        
        // ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function quitToStart() {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            
            document.getElementById('pause-overlay').classList.remove('active');
            document.getElementById('pause-btn').textContent = 'ì¼ì‹œì •ì§€';
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('start-screen').classList.remove('hidden');
        }
        
        // ê²Œì„ ì¢…ë£Œ (ë¸Œë¼ìš°ì € íƒ­/ì°½ ë‹«ê¸°)
        function endGame() {
            if (confirm('ì •ë§ ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.close();
                // window.close()ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš° (ë³´ì•ˆ ì •ì±…)
                // ë¹ˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
                setTimeout(() => {
                    document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#1a1a2e;color:#fff;font-family:sans-serif;text-align:center;padding:20px;"><div><h2>ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2><p style="margin-top:10px;color:#aaa;">ë¸Œë¼ìš°ì € íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”.</p></div></div>';
                }, 100);
            }
        }

        function gameLoop() {
            if (!gameState.isPlaying) return;
            
            update();
            draw();
            
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // ì„¸ì‹¬ì´ ì• ë‹ˆë©”ì´ì…˜
            if (sesim) {
                sesim.wingAngle += 0.3;
                sesim.floatOffset = Math.sin(Date.now() * 0.003) * 5;
            }
            
            // íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.15;
                p.life--;
                return p.life > 0;
            });
        }

        function draw() {
            // ë°°ê²½
            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, '#FFF8E1');
            gradient.addColorStop(0.5, '#FFECB3');
            gradient.addColorStop(1, '#FFE082');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // ë¼ìš´ë“œ ì •ë³´
            drawRoundInfo();
            
            // ì„¸ì‹¬ì´
            if (sesim) drawSesim();
            
            // ì„¸ê¸ˆ ì½”ì¸ ì˜ì—­
            drawCoinArea();
            
            // ì‹œë¯¼ë“¤
            citizens.forEach(citizen => drawCitizen(citizen));
            
            // ì„¸ê¸ˆ ì½”ì¸
            taxCoins.forEach(coin => drawCoin(coin));
            
            // í™•ì¸ ë²„íŠ¼
            drawCheckButton();
            
            // ë¦¬ì…‹ ë²„íŠ¼
            drawResetButton();
            
            // í”¼ë“œë°± ë©”ì‹œì§€
            drawFeedbackMessage();
            
            // íŒŒí‹°í´
            particles.forEach(p => {
                ctx.globalAlpha = p.life / 40;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // í™”ë©´ í”Œë˜ì‹œ íš¨ê³¼
            if (gameState.screenFlash && gameState.screenFlash.time > 0) {
                ctx.fillStyle = gameState.screenFlash.color;
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                gameState.screenFlash.time--;
                if (gameState.screenFlash.time <= 0) {
                    gameState.screenFlash = null;
                }
            }
        }

        function drawRoundInfo() {
            const data = roundData[gameState.round - 1];
            
            ctx.fillStyle = '#E65100';
            ctx.font = 'bold 20px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.fillText(data.title, canvasWidth / 2, 80);
            
            ctx.fillStyle = '#F57C00';
            ctx.font = '14px Noto Sans KR';
            ctx.fillText(data.description, canvasWidth / 2, 105);
        }

        function drawCoinArea() {
            const isMobile = canvasHeight < 700;
            const areaY = isMobile ? 125 : 140;
            const areaHeight = isMobile ? 90 : 100;
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.beginPath();
            ctx.roundRect(canvasWidth / 2 - 150, areaY, 300, areaHeight, 15);
            ctx.fill();
            ctx.strokeStyle = '#FFB74D';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.fillStyle = '#E65100';
            ctx.font = 'bold 12px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ’° ì„¸ê¸ˆ ì½”ì¸ì„ ì‹œë¯¼ì—ê²Œ ë¶„ë°°í•˜ì„¸ìš”!', canvasWidth / 2, areaY + 18);
        }

        function drawSesim() {
            const x = sesim.x;
            const y = sesim.y + sesim.floatOffset;
            const size = sesim.size;
            
            ctx.save();
            
            // ë‚ ê°œ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';
            ctx.strokeStyle = 'rgba(150, 150, 150, 0.4)';
            ctx.lineWidth = 2;
            
            const wingOffset = Math.sin(sesim.wingAngle) * 4;
            
            ctx.beginPath();
            ctx.ellipse(x - size * 0.7, y + wingOffset, size * 0.3, size * 0.45, -0.3, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            ctx.beginPath();
            ctx.ellipse(x + size * 0.7, y - wingOffset, size * 0.3, size * 0.45, 0.3, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // ëª¸í†µ
            ctx.beginPath();
            ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            ctx.fillStyle = '#4A3728';
            ctx.fill();
            ctx.strokeStyle = '#3D2E1F';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ë…¸ë€ ë°°
            ctx.beginPath();
            ctx.arc(x, y + size * 0.12, size * 0.4, 0.2, Math.PI - 0.2);
            ctx.fillStyle = '#FFD93D';
            ctx.fill();
            
            // ì–¼êµ´
            ctx.beginPath();
            ctx.ellipse(x, y - size * 0.1, size * 0.35, size * 0.28, 0, 0, Math.PI * 2);
            ctx.fillStyle = '#FFE4B5';
            ctx.fill();
            
            // ëˆˆ
            ctx.fillStyle = '#2D2D2D';
            ctx.beginPath();
            ctx.ellipse(x - size * 0.13, y - size * 0.13, size * 0.06, size * 0.08, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(x + size * 0.13, y - size * 0.13, size * 0.06, size * 0.08, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ë³¼í„°ì¹˜
            ctx.fillStyle = 'rgba(255, 182, 193, 0.6)';
            ctx.beginPath();
            ctx.ellipse(x - size * 0.25, y - size * 0.03, size * 0.07, size * 0.04, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(x + size * 0.25, y - size * 0.03, size * 0.07, size * 0.04, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ì…
            ctx.fillStyle = '#E85A4F';
            ctx.beginPath();
            ctx.arc(x, y + size * 0.02, size * 0.07, 0, Math.PI);
            ctx.fill();
            
            // ë”ë“¬ì´
            ctx.strokeStyle = '#4A3728';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(x - size * 0.12, y - size * 0.38);
            ctx.lineTo(x - size * 0.2, y - size * 0.6);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x + size * 0.12, y - size * 0.38);
            ctx.lineTo(x + size * 0.2, y - size * 0.6);
            ctx.stroke();
            
            // ë”ë“¬ì´ ë ê³µ
            ctx.fillStyle = '#FFD93D';
            ctx.strokeStyle = '#4A3728';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(x - size * 0.2, y - size * 0.62, size * 0.1, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(x + size * 0.2, y - size * 0.62, size * 0.1, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            ctx.restore();
        }

        function drawCitizen(citizen) {
            // ì¹´ë“œ ë°°ê²½
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.roundRect(citizen.x, citizen.y, citizen.width, citizen.height, 12);
            ctx.fill();
            ctx.strokeStyle = '#FFB74D';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ì´ëª¨ì§€
            ctx.font = '35px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(citizen.emoji, citizen.x + citizen.width / 2, citizen.y + 45);
            
            // ì´ë¦„
            ctx.fillStyle = '#4A3728';
            ctx.font = 'bold 13px Noto Sans KR';
            ctx.fillText(citizen.name, citizen.x + citizen.width / 2, citizen.y + 70);
            
            // ì†Œë“
            ctx.fillStyle = '#E65100';
            ctx.font = '11px Noto Sans KR';
            ctx.fillText(`ì†Œë“: ${citizen.income.toLocaleString()}ë§Œì›`, citizen.x + citizen.width / 2, citizen.y + 90);
            
            // ë°°ë¶„ëœ ì„¸ê¸ˆ ì½”ì¸
            if (citizen.assignedCoins > 0) {
                ctx.fillStyle = '#FFF8E1';
                ctx.beginPath();
                ctx.roundRect(citizen.x + 10, citizen.y + 100, citizen.width - 20, 40, 8);
                ctx.fill();
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.font = '22px sans-serif';
                ctx.fillText('ğŸ’°'.repeat(Math.min(citizen.assignedCoins, 4)), citizen.x + citizen.width / 2, citizen.y + 128);
                
                if (citizen.assignedCoins > 4) {
                    ctx.fillStyle = '#E65100';
                    ctx.font = 'bold 12px Noto Sans KR';
                    ctx.fillText(`x${citizen.assignedCoins}`, citizen.x + citizen.width - 20, citizen.y + 115);
                }
            } else {
                ctx.fillStyle = '#EEE';
                ctx.beginPath();
                ctx.roundRect(citizen.x + 10, citizen.y + 100, citizen.width - 20, 40, 8);
                ctx.fill();
                
                ctx.fillStyle = '#AAA';
                ctx.font = '11px Noto Sans KR';
                ctx.fillText('ì„¸ê¸ˆ ë°°ë¶„ ëŒ€ê¸°', citizen.x + citizen.width / 2, citizen.y + 125);
            }
        }

        function drawCoin(coin) {
            ctx.save();
            
            // ê¸€ë¡œìš°
            const gradient = ctx.createRadialGradient(coin.x, coin.y, 0, coin.x, coin.y, coin.size + 10);
            gradient.addColorStop(0, 'rgba(255, 215, 0, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(coin.x, coin.y, coin.size + 10, 0, Math.PI * 2);
            ctx.fill();
            
            // ì½”ì¸
            ctx.beginPath();
            ctx.arc(coin.x, coin.y, coin.size, 0, Math.PI * 2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            ctx.strokeStyle = '#FFA000';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ì„¸ê¸ˆ ë§ˆí¬
            ctx.fillStyle = '#E65100';
            ctx.font = 'bold 16px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('â‚©', coin.x, coin.y);
            
            ctx.restore();
        }

        function drawCheckButton() {
            if (!checkButton) return;
            
            // ê·¸ë¦¼ì
            ctx.fillStyle = '#388E3C';
            ctx.beginPath();
            ctx.roundRect(checkButton.x, checkButton.y + 4, checkButton.width, checkButton.height, 20);
            ctx.fill();
            
            // ë²„íŠ¼ ë³¸ì²´
            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.roundRect(checkButton.x, checkButton.y, checkButton.width, checkButton.height, 20);
            ctx.fill();
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 16px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âœ“ í™•ì¸', checkButton.x + checkButton.width / 2, checkButton.y + checkButton.height / 2);
        }
        
        function drawResetButton() {
            if (!resetButton) return;
            
            // ê·¸ë¦¼ì
            ctx.fillStyle = '#F57C00';
            ctx.beginPath();
            ctx.roundRect(resetButton.x, resetButton.y + 4, resetButton.width, resetButton.height, 20);
            ctx.fill();
            
            // ë²„íŠ¼ ë³¸ì²´
            ctx.fillStyle = '#FF9800';
            ctx.beginPath();
            ctx.roundRect(resetButton.x, resetButton.y, resetButton.width, resetButton.height, 20);
            ctx.fill();
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 16px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('â†º ë‹¤ì‹œ', resetButton.x + resetButton.width / 2, resetButton.y + resetButton.height / 2);
        }
        
        function drawFeedbackMessage() {
            if (!gameState.feedbackMessage || gameState.feedbackMessage.time <= 0) return;
            
            gameState.feedbackMessage.time--;
            
            const alpha = Math.min(1, gameState.feedbackMessage.time / 30);
            
            // ë°°ê²½
            ctx.fillStyle = `rgba(244, 67, 54, ${0.9 * alpha})`;
            ctx.beginPath();
            ctx.roundRect(canvasWidth / 2 - 160, canvasHeight / 2 - 30, 320, 60, 15);
            ctx.fill();
            
            // í…Œë‘ë¦¬
            ctx.strokeStyle = `rgba(255, 255, 255, ${0.8 * alpha})`;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
            ctx.font = 'bold 16px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âŒ ' + gameState.feedbackMessage.text, canvasWidth / 2, canvasHeight / 2 - 5);
            ctx.font = '13px Noto Sans KR';
            ctx.fillText('ì½”ì¸ì„ í„°ì¹˜í•˜ì—¬ íšŒìˆ˜í•˜ê±°ë‚˜ [ë‹¤ì‹œ] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”', canvasWidth / 2, canvasHeight / 2 + 18);
            
            if (gameState.feedbackMessage.time <= 0) {
                gameState.feedbackMessage = null;
            }
        }

        // ì‹œì‘
        window.addEventListener('load', init);
    </script>
</body>
</html>
